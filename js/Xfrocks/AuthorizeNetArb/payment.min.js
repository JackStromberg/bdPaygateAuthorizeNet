((window,document)=>{"use strict";XF.AuthorizeNetArb_PayForm=XF.Element.newHandler({options:{apiLoginId:null,hiddenInputSelector:"[name=opaque_data]",phrasePreparing:null,phraseProcessing:null,progressTextSelector:null,publicClientKey:null},xhr:null,init:function(){this.options.apiLoginId?this.options.publicClientKey?(this.hiddenInput=this.target.querySelector(this.options.hiddenInputSelector),this.hiddenInput?(this.progressText=this.target.querySelector(this.options.progressTextSelector),this.target.addEventListener("ajax-submit:before",this.onBeforeAjaxSubmit.bind(this)),this.target.addEventListener("ajax-submit:always",this.onBeforeAjaxAlways.bind(this)),this.target.addEventListener("submit",this.onSubmit.bind(this))):console.error("Form must contain a data-hidden-input-selector attribute.")):console.error("Form must contain a data-public-client-key attribute."):console.error("Form must contain a data-api-login-id attribute.")},onBeforeAjaxSubmit:function(e,config){if(config.ajaxOptions.timeout=9e4,this.hiddenInput.value)return this.progressText.textContent=this.options.phraseProcessing,!0;e.preventDefault()},onBeforeAjaxAlways:function(){this.hiddenInput.value="",this.progressText.textContent=""},onSubmit:function(e){if(this.hiddenInput.value)return!0;e.preventDefault(),e.preventSubmit=!0;const secureData={},authData={},cardData={},fill=(obj,key,rel=key)=>{const inputElement=this.target.querySelector(`input[rel="${rel}"]`);let val=inputElement?inputElement.value:null;if(!val){const dropdown=this.target.querySelector(`select[rel="${rel}"]`);val=dropdown?dropdown.value:null}val&&(obj[key]=val)};return fill(cardData,"cardNumber","card-number"),fill(cardData,"month"),fill(cardData,"year"),fill(cardData,"cardCode","card-code"),secureData.cardData=cardData,authData.apiLoginID=this.options.apiLoginId,authData.clientKey=this.options.publicClientKey,secureData.authData=authData,this._callAjaxSubmit("disableButtons"),this.progressText.textContent=this.options.phrasePreparing,Accept.dispatchData(secureData,this.onAcceptJsResponse.bind(this)),!1},onAcceptJsResponse:function(response){if(this.progressText.textContent="",this._callAjaxSubmit("enableButtons"),"Error"!==response.messages?.resultCode)this.hiddenInput.value=JSON.stringify(response.opaqueData),setTimeout((()=>{this._callAjaxSubmit("submit")}),0);else{const{messages:messages}=response,text=messages.message.map((message=>(console.error(`${message.code}: ${message.text}`),message.text)));XF.alert(text.join("<br />"))}},_callAjaxSubmit:function(method,args){const handlers=this.target.dataset.xfElementHandlers?JSON.parse(this.target.dataset.xfElementHandlers):{};if(handlers["ajax-submit"])return handlers["ajax-submit"][method].apply(handlers["ajax-submit"],args)}}),XF.Element.register("authorizenet-payment-form","XF.AuthorizeNetArb_PayForm")})(window,document);